package com.model;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

import javax.naming.InitialContext;
import javax.sql.DataSource;

public class Quiz_DAO {

    private static Quiz_DAO instance = new Quiz_DAO();
    private DataSource ds;

    Quiz_DAO() {

        try {
            InitialContext init = new InitialContext();

            ds = (DataSource) init.lookup("java:comp/env/jdbc/oracle");

        } catch (Exception e) {
            // TODO: handle exception
            e.printStackTrace();
            System.out.println("Error initializing Quiz_DAO");
        }

    }

    public static Quiz_DAO getInstance() {
        return instance;
    }

    public ArrayList<Quiz_DTO> getList(int department_id) { // 매개 변수로 부서번호를 받음

        ArrayList<Quiz_DTO> list = new ArrayList<>();

        String sql = "SELECT * FROM DEPARTMENTS WHERE DEPARTMENT_ID = ?";

        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            conn = ds.getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setInt(1, department_id); // 첫 번째 물음표에 부서번호를 설정

            rs = pstmt.executeQuery();

            while (rs.next()) {
                int departmentId = rs.getInt("DEPARTMENT_ID"); // 컬럼명은 대소문자 구분이 있으므로 주의
                String departmentName = rs.getString("DEPARTMENT_NAME");
                int managerId = rs.getInt("MANAGER_ID");
                int locationId = rs.getInt("LOCATION_ID");

                Quiz_DTO dto = new Quiz_DTO(departmentId, departmentName, managerId, locationId);

                list.add(dto);
            }
        } catch (Exception e) {
            e.printStackTrace();
            System.out.println("Error in getList() method");
        } finally {
            try {
                if (conn != null) conn.close();
                if (pstmt != null) pstmt.close();
                if (rs != null) rs.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        return list;
    }
}
